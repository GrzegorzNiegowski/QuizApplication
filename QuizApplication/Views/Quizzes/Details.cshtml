@model QuizApplication.Models.Quiz

@{
    ViewData["Title"] = "Szczegóły quizu";
}

<h2>@Model.Title</h2>


<div>
    <strong>Kod dostępu:</strong> @Model.AccessCode <br />
    <strong>Utworzono:</strong> @Model.CreatedAt.ToString("yyyy-MM-dd HH:mm") <br />
    <strong>Właściciel:</strong> @Model.Owner?.UserName ?? "—" <br />
</div>

<hr />


<p>
    @if (User.Identity?.IsAuthenticated == true && (User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value == Model.OwnerId || User.IsInRole("Admin")))
    {
        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary">Edytuj quiz</a>
        <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-danger">Usuń quiz</a>
        <a asp-controller="Questions" asp-action="Create" asp-route-quizId="@Model.Id" class="btn btn-success">Dodaj pytanie</a>
    }
    else
    {
        <a asp-action="Index" class="btn btn-secondary">Powrót</a>
    }
</p>

<hr />

<h3>Pytania</h3>
@if(Model.Questions == null || !Model.Questions.Any())
{
    <p>Brak pytań w tym quizie.</p>
}
{
<ol>
    @foreach (var q in Model.Questions.OrderBy(q => q.Id))
    {
        <li>
            <div>
                <strong>@q.Content</strong> <small>(@q.TimeLimitSeconds s)</small>
            </div>
            <ul>
                @foreach (var a in q.Answers)
                {
                    <li>
                        @a.Content
                        @if (a.IsCorrect)
                        {
                            <span class="badge bg-success ms-2">poprawna</span>
                        }
                    </li>
                }
            </ul>

            @* opcjonalne linki edit/delete pytania  *@
        </li>
    }
</ol>
}
<div>
    <a asp-action="Edit" asp-route-id="@Model?.Id">Edit</a> |
    <a asp-action="Index">Back to List</a>
    <a asp-controller="Questions" asp-action="Create" asp-route-quizId="@Model.Id" class="btn btn-primary">
        Dodaj pytanie
    </a>
</div>
