@{
    ViewData["Title"] = "Panel Hosta";
}
<div class="container text-center mt-5">
    <div class="card shadow-sm">
        <div class="card-body">
            <h2 class="text-muted">Kod dołączenia do gry:</h2>
            <h1 class="display-1 fw-bold text-primary" style="letter-spacing: 5px;">
                @ViewBag.AccessCode
            </h1>
            <p class="mb-4">Poproś graczy, aby weszli w zakładkę "Dołącz" i wpisali ten kod.</p>
            <hr />

            <h4 class="mb-3">Dołączyli gracze (<span id="playerCount">0</span>):</h4>

            <ul class="list-group list-group-flush mx-auto" style="max-width: 500px;" id="playersList">
                <li class="list-group-item text-muted fst-italic">Oczekiwanie na graczy...</li>
            </ul>

            <hr class="mt-4" />

            <button id="startGameBtn" class="btn btn-success btn-lg px-5" disabled>
                Rozpocznij Grę 🚀
            </button>
        </div>
    </div>
</div>
@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
    <script src="~/js/quiz-game.js"></script>
    <script>
        const code = "@ViewBag.AccessCode";
        const client = new QuizGameClient(code, "", true);
        client.connect();
            // Obsługa przycisku start
            document.getElementById("startGameBtn").addEventListener("click", async function () {
                this.disabled = true;
                this.innerText = "Rozpoczynanie...";

                try {
                    await client.connection.invoke("StartGame", code);
                } catch (err) {
                    console.error("Error starting game:", err);
                    this.disabled = false;
                    this.innerText = "Rozpocznij Grę 🚀";
                    alert("Nie udało się rozpocząć gry: " + err);
                }
            });
    </script>
}